<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Editar Cliente</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="cerrar()">
        <ion-icon name="close"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  
  <!-- BOTÓN EDITAR VENTA (solo si tiene venta realizada) -->
  @if (tieneVentaRealizada) {
    <ion-card color="success">
      <ion-card-content>
        <div class="venta-info-header">
          <div>
            <p>Venta registrada</p>
            <h2>{{ venta.cantidadVendida }} garrafones</h2>
            <p>${{ venta.total }}</p>
          </div>
          <ion-button fill="solid" color="light" (click)="editarVenta()">
            <ion-icon name="create-outline" slot="start"></ion-icon>
            Editar Venta
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
    
    <ion-item-divider>
      <ion-label>Datos del Cliente</ion-label>
    </ion-item-divider>
  }

  <!-- FORMULARIO CLIENTE -->
  <form [formGroup]="formCliente">
    
    <ion-list>
      <ion-item>
        <ion-input
          label="Representante *"
          labelPlacement="floating"
          formControlName="representante"
          placeholder="Ej. Juan Pérez">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-input
          label="Negocio"
          labelPlacement="floating"
          formControlName="negocio"
          placeholder="Ej. Tienda El Sol">
        </ion-input>
      </ion-item>

      <ion-item>
        <ion-input
          label="Teléfono"
          labelPlacement="floating"
          formControlName="telefono"
          type="tel"
          placeholder="Ej. 9511234567">
        </ion-input>
      </ion-item>

      <ion-item-divider>
        <ion-label>Ubicación</ion-label>
      </ion-item-divider>

      <ion-item>
        <ion-textarea
          label="Dirección *"
          labelPlacement="floating"
          formControlName="direccion"
          rows="2"
          placeholder="Ej. Av. Independencia #123">
        </ion-textarea>
      </ion-item>

      <ion-item>
        <ion-input
          label="Colonia *"
          labelPlacement="floating"
          formControlName="colonia"
          placeholder="Ej. Centro">
        </ion-input>
      </ion-item>

      <!-- COORDENADAS GPS -->
      <ion-item>
        <ion-label>
          <h3>Coordenadas GPS</h3>
          <p>Lat: {{ formCliente.get('latitud')?.value }}</p>
          <p>Lng: {{ formCliente.get('longitud')?.value }}</p>
        </ion-label>
        <ion-button slot="end" fill="outline" (click)="obtenerUbicacionActual()">
          <ion-icon name="navigate" slot="start"></ion-icon>
          Actualizar GPS
        </ion-button>
      </ion-item>
    </ion-list>

    <!-- BOTONES -->
    <div class="ion-padding-top">
      <ion-button 
        expand="block" 
        size="large"
        (click)="guardarCambios()"
        [disabled]="formCliente.invalid || guardando">
        <ion-icon name="save-outline" slot="start"></ion-icon>
        @if (guardando) {
          Guardando...
        } @else {
          Guardar Cambios
        }
      </ion-button>

      <ion-button 
        expand="block" 
        fill="outline" 
        (click)="cerrar()">
        Cancelar
      </ion-button>
    </div>

  </form>

</ion-content>