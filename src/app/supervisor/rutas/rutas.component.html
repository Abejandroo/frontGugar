<ion-content [fullscreen]="true">
  
  @if (cargando) {
    <div class="loading-container">
      <ion-spinner name="crescent" color="primary"></ion-spinner>
      <p>Cargando ruta...</p>
    </div>
  } @else {

    <div class="map-header">
      <google-map 
        height="35vh" 
        width="100%" 
        [center]="center" 
        [zoom]="zoom" 
        [options]="mapOptions">
        
        @for (marker of marcadoresClientes; track marker.title) {
          <map-marker [position]="marker.position" [title]="marker.title" [options]="{icon: marker.icon}"></map-marker>
        }

        @if (marcadorRepartidor) {
          <map-marker 
            [position]="marcadorRepartidor.position" 
            [title]="marcadorRepartidor.title"
            [options]="{icon: marcadorRepartidor.icon, animation: 1}"> </map-marker>
        }
      </google-map>
      
      <button class="back-button-map" (click)="regresar()">
        <ion-icon name="arrow-back"></ion-icon>
      </button>
    </div>

    <div class="ruta-container">
      
      <div class="info-header">
        <div class="title">
          <p class="ruta">Ruta #{{ rutaData.id }} · <span>{{ rutaData.nombre }}</span></p>
          <div class="repartidor-info">
            <ion-icon name="bicycle-outline"></ion-icon>
            <div>
              <small>Repartidor asignado:</small>
              <strong>{{ rutaData.repartidor?.name || 'Sin Asignar' }}</strong>
            </div>
          </div>
        </div>
        <button class="edit-button">
          <ion-icon name="create-outline"></ion-icon> Editar
        </button>
      </div>

      <div class="search-section">
        <div class="input-wrapper">
          <ion-icon name="search-outline"></ion-icon>
          <input type="text" placeholder="Buscar cliente o dirección..." />
        </div>
      </div>

      <div class="filter-row">
        <div class="filter">
          <label for="dia">Día:</label>
          <select id="dia">
            <option>Todos</option>
            <option>Lunes</option>
            <option>Martes</option>
            <option>Miércoles</option>
            </select>
        </div>
        <p class="clientes-count">{{ clientesLista.length }} clientes</p>
      </div>

      <div class="clientes-list">
        
        @for (cliente of clientesLista; track cliente.id) {
          <div class="cliente-card">
            <div class="cliente-info">
              <h3>{{ cliente.nombre }}</h3>
              <p>
                <ion-icon name="location-outline"></ion-icon>
                {{ cliente.calle }} {{ cliente.colonia }}
              </p>
            </div>
            <span class="dia-badge">{{ cliente.diaVisita }}</span>
          </div>
        } @empty {
          <div class="empty-msg">No hay clientes asignados a esta ruta.</div>
        }

      </div>
    </div>
  }

</ion-content>

<ion-footer class="ion-no-border" style="background: transparent; box-shadow: none;">
  <app-supervisor-navbar paginaActual="rutas"></app-supervisor-navbar>
</ion-footer>